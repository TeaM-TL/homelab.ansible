{% if ansible_hostname in groups['ns-masters'] %}
zone "{{ domain }}" IN {
    type master;
    file "/etc/named/zones/db.{{ domain }}";
    allow-update { key rndc-key; };
    allow-transfer { 10.3.3.0/24; };
    notify yes;
};

zone "{{ rev_domain }}" IN {
    type master;
    file "/etc/named/zones/db.{{ rev_domain }}";
    allow-update { key rndc-key; };
    allow-transfer { 10.3.3.0/24; };
    notify yes;
};
{% else %}
zone "{{ domain }}" IN {
  type slave;
  file "/etc/named/zones/db.{{ domain }}";
  allow-update-forwarding {127.0.0.1; {{ hostvars['ns1'].ip_address }}; {{ hostvars['ns2'].ip_address }}; };
  allow-notify { {{ hostvars['ns1'].ip_address }}; };
  allow-transfer { {{ hostvars['ns1'].ip_address }}; };
  masters { {{ hostvars['ns1'].ip_address }}; };
};

zone "{{ rev_domain }}" IN {
  type slave;
  file "/etc/named/zones/db.{{ rev_domain }}";
  allow-update-forwarding {127.0.0.1; {{ hostvars['ns1'].ip_address }}; {{ hostvars['ns2'].ip_address }}; };
  allow-notify { {{ hostvars['ns1'].ip_address }}; };
  allow-transfer { {{ hostvars['ns1'].ip_address }}; };
  masters { {{ hostvars['ns1'].ip_address }}; };
};

{% endif %}
